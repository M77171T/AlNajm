name: بناء نظام التشغيل المتعدد النجم

on: [push, pull_request]

jobs:
  build-windows:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4

      - name: تثبيت التبعيات النظام
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential libtool autotools-dev automake pkg-config bsdmainutils curl git g++-mingw-w64-x86-64 python3

      - name: بناء ويندوز (Windows Build)
        run: |
          # التحقق من وجود مجلد depends، إذا لم يوجد سيتم تخطي الخطوة
          if [ -d "depends" ]; then
            cd depends
            # إذا كان هناك Makefile سنقوم بالبناء، وإلا سنقوم بالتحميل أولاً
            if [ -f "Makefile" ]; then
              make HOST=x86_64-w64-mingw32 -j$(nproc)
            else
              echo "Makefile not found in depends, attempting to continue..."
            fi
            cd ..
          fi

          # إعطاء صلاحيات التشغيل لملفات البناء الأساسية
          chmod +x autogen.sh
          chmod +x share/genbuild.sh || true
          
          # البدء في بناء المشروع الرئيسي
          ./autogen.sh
          
          # التكوين للبناء (إذا فش
